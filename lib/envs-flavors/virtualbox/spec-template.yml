---
subsys:
  name: ~ # must conform to this pattern: '*-env'
  type: bosh-environment

input_resources:
  - name: bosh-deployment
    type: git
    uri: https://github.com/cloudfoundry/bosh-deployment.git
    version: "28deae6" # BOSH v268.2.0 (as of Oct 26nd, 2018)
  - name: prometheus-boshrelease
    type: git
    uri: https://github.com/bosh-prometheus/prometheus-boshrelease.git
    version: v23.0.0


infra_vars:
  alias: ~ # the Bosh CLI alias, usually 'vbox'
  iaas: virtualbox # the GBE environment flavor

dns:
  zone: prototyp.it
  subdomain: easyfoundry


main_deployment_file: bosh-deployment/bosh.yml

operations_files:
  10.bosh-deployment:
    - virtualbox/cpi

    # The 'outbound-network' option below enables a 'NAT' network to be
    # defined in order for the Vitrualbox environment to expose TCP ports to
    # the outside Internet world. Indeed 'vip' networks are not supported by
    # the VirtualBox CPI.
    #
    # For a concrete example of a 'NAT' network that the Virtualbox CPI uses
    # to expose TCP ports, see the 'enable-vbox-port-forwarding' ops file.
    #
    # The limitation with 'outbound-network' is that when Virtualbox is run by
    # a non-root user (which is recommended for security reasons), then ports
    # below the 1024 threshold cannot be exposed, which is inconvenient for
    # usual HTTP(S) ports like 80 and 443.
    #
    # This 'outbound-network' requires the 'outbound_network_name' variable to
    # be set to 'NatNetwork' below. Other values wouldn't let you expose
    # ports, which is the main value here.
    #
    # - virtualbox/outbound-network

    # The 'remote' option is essential for driving a distant Virtualbox
    # environment.
    #
    # Requires 'vbox_host', 'vbox_username' and 'vbox_ssh.private_key' to be
    # set below or in the 'private.yml' file with restricted permissions. See
    # example below.
    #
    - virtualbox/remote

    - bosh-lite
    - bosh-lite-runc
    - jumpbox-user
    - external-ip-not-recommended
    - uaa
    - credhub
    - local-dns
  20.prometheus-boshrelease:
    - manifests/operators/bosh/add-bosh-exporter-uaa-clients
  30.local:
    # - enable-vbox-port-forwarding # disabled in favor of a more consistent setup based on iptables
    - custom-stemcell-version
    - custom-bosh-version-precompiled
    # - custom-bosh-version
    - disable-resurrector
    - set-disk-size
    - scale-vm-size
    - enable-index-based-dns-aliases

variables_files:
  10.local:
    - file: secrets
      example:
        vbox_ssh:
          private_key: |
            -----BEGIN RSA PRIVATE KEY-----
            ...
            -----END RSA PRIVATE KEY-----


deployment_vars:
  director_name: easyfoundry-director

  disk_size: 200_000 # i.e. 200MB

  external_ip: ~ # The public IP of your distant box, for DNS to target to

  vbox_host: ~     # SSH host to connect to in order to run 'vboxmanage' commands.
                   # Related to 'virtualbox/remote' above.
                   # When left unspecified, 'vboxmanage' is run locally.
  vbox_username: ~ # SSH username that will run the 'vboxmanage' commands.
                   # Only required when 'vbox_host' is specified.

  routable_network_cidr: 10.244.0.0/16 # CIDR range of internal addresses that
                                       # should be accessible from the gbe CLI

  # web_router_ip: "10.244.0.34" # classical Gorouter reverse-proxy
  web_router_ip: "10.244.0.43" # Tr√¶fik reverse-proxy for Let's Encrypt support

  internal_ip: "192.168.50.6"
  internal_gw: "192.168.50.1"
  internal_cidr: 192.168.50.0/24
  # outbound_network_name: NatNetwork # Related to 'virtualbox/outbound-network' above


  # Versions

  bosh_precompiled_version: "268.2.0"
  bosh_precompiled_url: https://s3.amazonaws.com/bosh-compiled-release-tarballs/bosh-268.2.0-ubuntu-xenial-97.28-20181024-210824-586102372-20181024210828.tgz
  bosh_precompiled_sha1: 3107ba41a109561cf181862ac59aa1e82ab0b286

  stemcell_name: bosh-vsphere-esxi-ubuntu-xenial-go_agent
  stemcell_version: "97.28"
  stemcell_sha1: 6fca8124ae7455bd95ebb074ddb0436bf1832fb1


imported_vars: []
