---
subsys:
  name: shield-v8
  type: bosh-deployment
  deploy_after: cf

input_resources:
  - name: shield-boshrelease-v8
    type: git
    uri: https://github.com/starkandwayne/shield-boshrelease.git
    version: v8.0.10


main_deployment_file: shield-boshrelease-v8/manifests/shield.yml

operations_files:
  local:
    - inject-variables
    - set-versions
    # - routing # TLS routing doesn't support self-signed certificates yet
    - expose-ports
    - scale-disks


deployment_vars:
  deployment_name: easyfoundry-shield-v8


  # User-facing settings

  shield_domain: shield-v8.easyfoundry.prototyp.it
  shield_port: 10443 # injected in cloud-config
  shield_color: red


  # Versions

  shield_version: "8.0.10"
  shield_sha1: 6b91a9a14a9e4f055a58acdb1b99e5920abdf16f

  # routing_version:  # imported below
  # routing_sha1:     # imported below

  # stemcell_name:    # imported below
  # stemcell_version: # imported below
  # stemcell_sha1:    # imported below


  # Plumbery
  shield_disk_type: 2GB


  # Reference declarations

  network_name: shield-v8-network # injected in cloud-config
  shield_vm_extension: shield-v8-loadbalancer # injected in cloud-config
  shield_internal_hostname: shield-v8.easyfoundry.internal # injected in runtime-config


imported_vars:
  - subsys: cf
    imports:

      - name: routing_version
        from: depl-vars
        path: /routing_version
      - name: routing_sha1
        from: depl-vars
        path: /routing_sha1

      - name: stemcell_name
        from: depl-vars
        path: /stemcell_name
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1

      - name: cf_deployment_name
        from: depl-vars
        path: /deployment_name
