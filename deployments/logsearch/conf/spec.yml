---
subsys:
  name: logsearch
  type: bosh-deployment
  depends_on: [ cf ]

input_resources:
  - name: logsearch-boshrelease
    type: git
    uri: https://github.com/cloudfoundry-community/logsearch-boshrelease.git
    version: "73bd28b" # v209.0.1 with improved deployment manifests, as of Oct 31st, 2018


# main_deployment_file: ./conf/logsearch-deployment.yml
main_deployment_file: logsearch-boshrelease/deployment/logsearch-deployment.yml

operations_files:
  10.logsearch-boshrelease:
    - deployment/operations/cerebro
    - deployment/operations/cloudfoundry
  20.local:
    - rename-deployment
    - pin-stemcell
    - set-versions
    - scale-vms
    - cf-integration
    - bosh-lite-support
    - scale-disks


deployment_vars:
  deployment_name: easyfoundry-logsearch


  # Scaling

  elasticsearch_master_nodes: 1
  elasticsearch_data_nodes: 2
  ingestor_nodes: 1
  elasticsearch_heap_size: 500M
  logstash_heap_size: 500M


  # Versions

  logsearch_version: "209.0.1"
  logsearch_sha1: 038b039dc30d71a4c3ed4570035867797538edef

  logsearch_for_cloudfoundry_version: "207.0.1"
  logsearch_for_cloudfoundry_sha1: 599d238be5281f5a2ef903936b9ef868611baab1

  # stemcell_os:      # imported below
  # stemcell_version: # imported below
  # stemcell_sha1:    # imported below


  # Reference declarations

  network_name: default


imported_vars:
  - subsys: cf
    imports:

      # Versions

      - name: stemcell_os
        from: depl-vars
        path: /stemcell_os
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1


      # CF Plumbery

      - name: cf_deployment_name
        from: depl-vars
        path: /deployment_name

      - name: cf_admin_password
        from: depl-creds
        path: /cf_admin_password

      - name: uaa_admin_client_secret
        from: depl-creds
        path: /uaa_admin_client_secret

      - name: system_domain
        from: depl-vars
        path: /system_domain
