---
subsys:
  name: cf
  type: bosh-deployment

input_resources:
  - name: cf-deployment
    type: git
    uri: https://github.com/cloudfoundry/cf-deployment.git
    version: v1.40.0
  - name: prometheus-boshrelease
    type: git
    uri: https://github.com/bosh-prometheus/prometheus-boshrelease.git
    version: v23.0.0


main_deployment_file: cf-deployment/cf-deployment.yml

operations_files:
  10.cf-deployment:
    - operations/use-compiled-releases
    - operations/secure-rep-admin-api
    - operations/bosh-lite
    - operations/rename-deployment
    - operations/rename-network
    - operations/override-app-domains

    - operations/backup-and-restore/enable-backup-restore

    # - operations/experimental/bits-service
    # - operations/experimental/bits-service-local

    # - operations/experimental/disable-consul
    # - operations/experimental/disable-consul-bosh-lite

    # - operations/experimental/routing-integrity
    # - operations/experimental/enable-prefer-declarative-healthchecks

    # - operations/experimental/use-bosh-dns-rename-network-and-deployment

    - operations/experimental/use-silk-release # This is Silk v1, whereas cf-networking v2 comes with Silk v2
    # - operations/experimental/use-cf-networking-2
    # - operations/experimental/use-bosh-dns-for-containers-with-networking-2
    # - operations/experimental/enable-iptables-logger-with-networking-2

    # - operations/experimental/perm-service

    - operations/experimental/enable-service-discovery

    # - operations/experimental/secure-service-credentials
    # - operations/experimental/enable-backup-restore-credhub

    # - operations/experimental/rootless-containers

    # - operations/experimental/enable-mysql-tls.yml

    # - operations/enable-nfs-volume-service
    # - operations/enable-nfs-ldap
    # - operations/experimental/enable-nfs-broker-backup

    # - operations/experimental/use-pxc
    # - operations/experimental/migrate-cf-mysql-to-pxc
    # - operations/experimental/perm-service-with-pxc-release

  20.prometheus-boshrelease:
    - manifests/operators/cf/add-prometheus-uaa-clients
    - manifests/operators/cf/add-grafana-uaa-clients
  30.local:
    - set-stemcell-version
    # - set-mysql-version
    - set-routing-version
    - expose-admin-user-as-link
    - cassandra-support
    - database-mysql-bosh-lite
    - scale-disks
    - tls-from-gorouters-to-backends


deployment_vars:
  deployment_name: easyfoundry-cf


  # User-facing settings

  system_domain: sys.easyfoundry.prototyp.it
  app_domains:
    - name: &apps_domain apps.easyfoundry.prototyp.it
  smoke_test_app_domain: *apps_domain


  # Versions

  stemcell_name: bosh-warden-boshlite-ubuntu-trusty-go_agent
  stemcell_version: "3586.43"
  stemcell_sha1: 46cff63ad21e8d8e763e2acedd746bc4ac95aa27


  # Reference declarations

  routing_version: "0.179.0"
  routing_sha1: 203061d0438ed76f25573080f9d1f73f06de5851

  cf_mysql_version: "36.14.0"
  cf_mysql_sha1: 383f70fd4d776bf91d9043d8fd9ad79516cc8478

  uaa_version: "59"
  uaa_sha1: 6aa5cd78892f4ea09070c0cf5155aa7a12c17d13

  network_name: default # injected in cloud-config


imported_vars:
  - subsys: cf
    imports:
      - name: grafana_redirect_uri
        from: depl-vars
        value: https://uaa.((system_domain))/login

  - subsys: concourse
    imports:
      - name: concourse_external_ca_certificate
        from: depl-creds
        path: /concourse-external-ca/certificate
