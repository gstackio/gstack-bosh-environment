---
subsys:
  name: cf
  type: bosh-deployment

input_resources:
  - name: cf-deployment
    type: git
    uri: https://github.com/cloudfoundry/cf-deployment.git
    version: v1.30.0
  - name: prometheus-boshrelease
    type: git
    uri: https://github.com/bosh-prometheus/prometheus-boshrelease.git
    version: v22.0.2


main_deployment_file: cf-deployment/cf-deployment.yml

operations_files:
  10.cf-deployment:
    - operations/use-compiled-releases
    - operations/secure-rep-admin-api
    - operations/bosh-lite
    - operations/rename-deployment
    - operations/rename-network

    # - operations/backup-and-restore/enable-backup-restore

    # - operations/experimental/bits-service
    # - operations/experimental/bits-service-local

    # - operations/experimental/disable-consul
    # - operations/experimental/disable-consul-bosh-lite

    # - operations/experimental/enable-bpm
    # - operations/experimental/routing-integrity
    # - operations/experimental/enable-prefer-declarative-healthchecks

    - operations/experimental/use-silk-release # This is Silk v1, whereas cf-networking v2 comes with Silk v2
    # - operations/experimental/use-cf-networking-2
    # - operations/experimental/use-bosh-dns-for-containers-with-networking-2
    # - operations/experimental/enable-iptables-logger-with-networking-2

    - operations/experimental/enable-service-discovery

    # - operations/experimental/secure-service-credentials
    # - operations/experimental/enable-backup-restore-credhub

    # - operations/experimental/rootless-containers

    # - operations/enable-nfs-volume-service
    # - operations/enable-nfs-ldap
    # - operations/experimental/enable-nfs-broker-backup

  20.prometheus-boshrelease:
    - manifests/operators/cf/add-prometheus-uaa-clients
    - manifests/operators/cf/add-grafana-uaa-clients
  30.local:
    - set-stemcell-version
    # - set-mysql-version
    - set-routing-version
    - expose-admin-user-as-link
    - cassandra-support
    - enable-service-discovery-bosh-lite
    - database-mysql-bosh-lite
    - scale-disks


deployment_vars:
  deployment_name: easyfoundry-cf


  # User-facing settings

  system_domain: cf.easyfoundry.prototyp.it


  # Versions

  routing_version: "0.175.0"
  routing_sha1: 7314e7b070520561aef6fd4026501f3d23c5d67c

  stemcell_name: bosh-warden-boshlite-ubuntu-trusty-go_agent
  stemcell_version: "3541.24"
  stemcell_sha1: 08d4a99454999fe22d650afd990f8c4de279fe7b


  # Reference declarations

  cf_mysql_version: "36.13.0"
  cf_mysql_sha1: dc09695207bce0df81e85c5b8284a69a4e814651

  network_name: default # injected in cloud-config


imported_vars:
  - subsys: cf
    imports:
      - name: grafana_redirect_uri
        from: depl-vars
        value: https://uaa.((system_domain))/login
