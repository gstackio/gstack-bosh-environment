---
subsys:
  name: concourse
  type: bosh-deployment

input_resources:
  - name: concourse-deployment
    type: git
    uri: https://github.com/concourse/concourse-deployment.git
    version: v3.14.1


main_deployment_file: concourse-deployment/cluster/concourse.yml

operations_files:
  10.concourse-deployment:
    - cluster/operations/tls
    # - cluster/operations/tls-vars
    - cluster/operations/basic-auth
    - cluster/operations/web-network-extension
    - cluster/operations/worker-ephemeral-disk
  20.local:
    - tls-with-vars-and-external-ca
    - basic-auth-with-vars
    - pin-stemcell-version
    - use-http-not-recommended


deployment_vars:
  deployment_name: easyfoundry-concourse


  # User-facing settings

  external_url: ci.easyfoundry.prototyp.it
  atc_basic_auth: { username: admin }


  # Versions

  concourse_version: "3.14.1"
  concourse_sha1: 6be91b70ecc7ce233d2aff5d03ed28c8eab3d132

  garden_runc_version: "1.14.0"
  garden_runc_sha1: be5e6d6a263be1437d99dc5e818deeb8ab2a03a4

  postgres_version: "28"
  postgres_sha1: c1fcec62cb9d2e95e3b191e3c91d238e2b9d23fa

  # stemcell_name:    # imported below
  # stemcell_version: # imported below
  # stemcell_sha1:    # imported below


  # Scaling properties

  web_vm_type: default    # t2.nano      # 1 CPU, 0.5GB RAM
  db_vm_type: default     # t2.micro     # 1 CPU, 1GB RAM
  db_persistent_disk_type: 1GB
  worker_vm_type: default # m3.medium    # 1 CPU, 3.75GB RAM
  # A VM extension from your BOSH Director's cloud config that will attach
  # sufficient ephemeral storage to worker VMs.
  worker_ephemeral_disk: 50GB_ephemeral_disk # consider 100GB for production systems


  # Reference declarations

  network_name: &network_name concourse-network # injected in cloud-config
  # A VM extension from your BOSH Director's cloud config that will attach 'web'
  # instances to your ELB.
  web_network_vm_extension: concourse-atc-loadbalancer
  web_network_name: *network_name # Plumbery for the 'web-network-extension.yml' ops file


imported_vars:
  - subsys: cf
    imports:

      - name: stemcell_name
        from: depl-vars
        path: /stemcell_name
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1
