---
subsys:
  name: concourse
  type: bosh-deployment

input_resources:
  - name: concourse-deployment
    type: git
    uri: https://github.com/concourse/concourse-deployment.git
    version: v3.12.0


main_deployment_file: concourse-deployment/cluster/concourse.yml

operations_files:
  10.concourse-deployment:
    - cluster/operations/tls
    - cluster/operations/basic-auth
    - cluster/operations/web-network-extension
    - cluster/operations/worker-ephemeral-disk
  20.local:
    - add-tls-vars
    - add-basic-auth-vars
    - set-stemcell-version
    - use-http-not-recommended


deployment_vars:
  deployment_name: easyfoundry-concourse


  # User-facing settings

  external_url: ci.easyfoundry.prototyp.it
  atc_basic_auth: { username: benjamin }


  # Versions

  concourse_version: "3.12.0"
  concourse_sha1: 12746f25cd484bdd9a8ed7151cfed20a142de2fa

  garden_runc_version: "1.13.1"
  garden_runc_sha1: 54cbb89cae1be0708aa056185671665d7f4b2a4f

  postgres_version: "28"
  postgres_sha1: c1fcec62cb9d2e95e3b191e3c91d238e2b9d23fa

  # stemcell_name: bosh-warden-boshlite-ubuntu-trusty-go_agent
  # stemcell_version: "3541.24"
  # stemcell_sha1: 08d4a99454999fe22d650afd990f8c4de279fe7b


  # Scaling properties

  web_vm_type: default    # t2.nano      # 1 CPU, 0.5GB RAM
  db_vm_type: default     # t2.micro     # 1 CPU, 1GB RAM
  db_persistent_disk_type: 1GB
  worker_vm_type: default # m3.medium    # 1 CPU, 3.75GB RAM
  # A VM extension from your BOSH Director's cloud config that will attach
  # sufficient ephemeral storage to worker VMs.
  worker_ephemeral_disk: 50GB_ephemeral_disk # consider 100GB for production systems


  # Reference declarations

  network_name: &network_name concourse-network # injected in cloud-config
  # A VM extension from your BOSH Director's cloud config that will attach 'web'
  # instances to your ELB.
  web_network_vm_extension: concourse-atc-loadbalancer
  web_network_name: *network_name # Plumbery for the 'web-network-extension.yml' ops file


imported_vars:
  - subsys: cf
    imports:

      - name: stemcell_name
        from: depl-vars
        path: /stemcell_name
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1
