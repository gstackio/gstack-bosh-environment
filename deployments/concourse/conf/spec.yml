---
subsys:
  name: concourse
  type: bosh-deployment

input_resources:
  - name: concourse-deployment
    type: git
    uri: https://github.com/concourse/concourse-deployment.git
    version: 32443de # base for v3.9.2, as of March 13th, 2018


main_deployment_file: concourse-deployment/cluster/concourse.yml

operations_files:
  10.concourse-deployment:
    - cluster/operations/tls
    - cluster/operations/basic-auth
    - cluster/operations/web-network-extension
    - cluster/operations/worker-ephemeral-disk
  20.local:
    - add-tls-vars
    - add-basic-auth-vars
    - set-stemcell-version
    - use-http-not-recommended


deployment_vars:
  deployment_name: easyfoundry-concourse


  # User-facing settings

  external_url: ci.easyfoundry.prototyp.it
  atc_basic_auth: { username: benjamin }


  # Versions

  concourse_version: "3.9.2"
  concourse_sha1: a0ebed14c296273f37ed2a7ec79b9a7814734e16

  garden_runc_version: "1.12.0"
  garden_runc_sha1: 9cb3ec63f04d6cfb3047229544f261ff737f203e

  postgres_version: "26"
  postgres_sha1: a436047dae4d4156a1debe9f88bedf59bf40362b

  # stemcell_name: bosh-warden-boshlite-ubuntu-trusty-go_agent
  # stemcell_version: "3541.12"
  # stemcell_sha1: 14bd6dd50d3caa913af97846eab39e5075b240d7


  # Scaling properties

  web_vm_type: default    # t2.nano      # 1 CPU, 0.5GB RAM
  db_vm_type: default     # t2.micro     # 1 CPU, 1GB RAM
  db_persistent_disk_type: 1GB
  worker_vm_type: default # m3.medium    # 1 CPU, 3.75GB RAM
  # A VM extension from your BOSH Director's cloud config that will attach
  # sufficient ephemeral storage to worker VMs.
  worker_ephemeral_disk: 50GB_ephemeral_disk # consider 100GB for production systems


  # Reference declarations

  network_name: &network_name concourse-network # injected in cloud-config
  # A VM extension from your BOSH Director's cloud config that will attach 'web'
  # instances to your ELB.
  web_network_vm_extension: concourse-atc-loadbalancer
  web_network_name: *network_name # Plumbery for the 'web-network-extension.yml' ops file


imported_vars:
  - subsys: cf
    imports:

      - name: stemcell_name
        from: depl-vars
        path: /stemcell_name
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1
