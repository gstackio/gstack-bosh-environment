---
subsys:
  name: concourse
  type: bosh-deployment

input_resources:
  - name: concourse-deployment
    type: git
    uri: https://github.com/concourse/concourse-deployment.git
    version: v3.14.1


main_deployment_file: concourse-deployment/cluster/concourse.yml

operations_files:
  10.concourse-deployment:
    - cluster/operations/web-network-extension
    - cluster/operations/worker-ephemeral-disk
    - cluster/operations/static-web
  20.local:
    - pin-stemcell-version
    - set-log-level
    - basic-auth-with-vars       # replaces 'cluster/operations/basic-auth'
    # We still have an issue with this encryption key and the bosh v2.0.45 CLI
    - atc-db-encryption-with-var # replaces 'cluster/operations/encryption'
    # - use-http-not-recommended
    - tls-with-vars-and-external-ca # replaces 'cluster/operations/tls' and 'cluster/operations/tls-vars'
    - credhub-integration-with-uaa-and-db-tls
    - routing # requires 'cluster/operations/static-web'


deployment_vars:
  deployment_name: easyfoundry-concourse


  # User-facing settings

  concourse_domain: ci.easyfoundry.prototyp.it
  atc_basic_auth_username: admin


  # Versions

  concourse_version: "3.14.1"
  concourse_sha1: 6be91b70ecc7ce233d2aff5d03ed28c8eab3d132

  garden_runc_version: "1.14.0"
  garden_runc_sha1: be5e6d6a263be1437d99dc5e818deeb8ab2a03a4

  postgres_version: "28"
  postgres_sha1: c1fcec62cb9d2e95e3b191e3c91d238e2b9d23fa

  credhub_version: "1.9.3"
  credhub_sha1: 648658efdef2ff18a69914d958bcd7ebfa88027a

  os_conf_version: "20"
  os_conf_sha1: 42b1295896c1fbcd36b55bfdedfe86782b2c9fba

  # uaa_version:  # imported below
  # uaa_sha1:     # imported below

  # routing_version:  # imported below
  # routing_sha1:     # imported below

  # stemcell_os:      # imported below
  # stemcell_version: # imported below
  # stemcell_sha1:    # imported below


  # Scaling properties

  web_vm_type: default    # t2.nano      # 1 CPU, 0.5GB RAM
  db_vm_type: default     # t2.micro     # 1 CPU, 1GB RAM
  db_persistent_disk_type: 1GB
  worker_vm_type: default # m3.medium    # 1 CPU, 3.75GB RAM
  # A VM extension from your BOSH Director's cloud config that will attach
  # sufficient ephemeral storage to worker VMs.
  worker_ephemeral_disk: 50GB_ephemeral_disk # consider 200GB for production systems
  log_level: info # set this to 'debug' whenever necessary


  # Reference declarations

  network_name: &network_name concourse-network # injected in cloud-config
  web_ip: 10.244.16.2 # first address in the 'static' range
  # A VM extension from your BOSH Director's cloud config that will attach 'web'
  # instances to your ELB.
  web_network_vm_extension: concourse-atc-loadbalancer
  web_network_name: *network_name # Plumbery for the 'web-network-extension.yml' ops file


imported_vars:
  - subsys: cf
    imports:

      - name: stemcell_os
        from: depl-vars
        path: /stemcell_os
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1

      - name: routing_version
        from: depl-vars
        path: /routing_version
      - name: routing_sha1
        from: depl-vars
        path: /routing_sha1

      - name: uaa_version
        from: depl-vars
        path: /uaa_version
      - name: uaa_sha1
        from: depl-vars
        path: /uaa_sha1

      - name: cf_deployment_name
        from: depl-vars
        path: /deployment_name
