---
subsys:
  name: data-services
  type: bosh-deployment
  deploy_after: cf

input_resources:
  # - name: docker-boshrelease
  #   type: git
  #   uri: https://github.com/cloudfoundry-incubator/docker-boshrelease.git
  #   version: v32.0.0
  # - name: cf-containers-broker-boshrelease
  #   type: git
  #   uri: https://github.com/cloudfoundry-community/cf-containers-broker-boshrelease.git
  #   version: v1.0.3
  - name: docker-broker-deployment
    type: git
    uri: https://github.com/cloudfoundry-community/docker-broker-deployment.git
    version: 2eb6456 # in the 'cf-containers-broker-boshrelease' branch, as of Dec. 1st, 2017
  - name: broker-registrar-boshrelease
    type: git
    uri: https://github.com/cloudfoundry-community/broker-registrar-boshrelease.git
    version: v3.4.0


# main_deployment_file: docker-boshrelease/manifests/containers/example.yml
main_deployment_file: docker-broker-deployment/docker-broker.yml


operations_files:
  10.docker-broker-deployment:
    - operators/cf-integration
    - operators/services/mysql56
    - operators/services/postgresql96
    - operators/services/redis32
  15.broker-registrar-boshrelease:
    - manifests/operators/cf-admin-user
  20.local:
    - set-versions
    - scale-disks
    - inject-variables # must be after 'use-cf-admin-user-link'
    - fix-errands-vms-names # must be last


deployment_vars:
  deployment_name: easyfoundry-data-services


  # User-facing settings

  broker-route-uri: data-services.easyfoundry.prototyp.it


  # Versions

  docker_version: "32.0.0"
  docker_sha1: 75a3e4f85f8d1a59b58c6b34cf568f72397b5680

  cf_containers_broker_version: "1.0.3"
  cf_containers_broker_sha1: 11001a58965ce4243bd18f0e4301cdbbe949a2d9

  broker_registrar_version: "3.4.0"
  broker_registrar_sha1: d44d9af8fd06ecf6d50004c9bfd5516a6e482201

  # routing_version: "0.173.0"
  # routing_sha1: 2c2ddd022f81f0f2d6e12fbd38bd1b1159edcf23

  # stemcell_name: bosh-warden-boshlite-ubuntu-trusty-go_agent
  # stemcell_version: "3541.12"
  # stemcell_sha1: 14bd6dd50d3caa913af97846eab39e5075b240d7


  # Reference declarations

  network_name: default


  # Plumbery

  broker-route-name: data-services-broker


imported_vars:
  - subsys: cf
    imports:

      - name: routing_version
        from: depl-vars
        path: /routing_version
      - name: routing_sha1
        from: depl-vars
        path: /routing_sha1

      - name: stemcell_name
        from: depl-vars
        path: /stemcell_name
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1

      - name: cf_deployment_name
        from: depl-vars
        path: /deployment_name

      - name: cf_skip_ssl_validation
        from: depl-manifest
        path: /instance_groups/name=smoke-tests/jobs/name=smoke_tests/properties/smoke_tests/skip_ssl_validation
