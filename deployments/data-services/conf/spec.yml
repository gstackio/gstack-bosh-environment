---
subsys:
  name: data-services
  type: bosh-deployment
  depends_on: [ cf ]

input_resources:
  # - name: docker-boshrelease
  #   type: git
  #   uri: https://github.com/cloudfoundry-incubator/docker-boshrelease.git
  #   version: v32.0.0
  - name: cf-containers-broker-boshrelease
    type: git
    uri: https://github.com/cloudfoundry-community/cf-containers-broker-boshrelease.git
    version: v1.0.3
  - name: broker-registrar-boshrelease
    type: git
    uri: https://github.com/cloudfoundry-community/broker-registrar-boshrelease.git
    version: v3.4.0


main_deployment_file: cf-containers-broker-boshrelease/manifests/docker-broker.yml


operations_files:
  10.cf-containers-broker-boshrelease:
    - manifests/operators/cf-integration
    - manifests/operators/services/mysql56
    - manifests/operators/services/postgresql96
    - manifests/operators/services/redis32
  15.broker-registrar-boshrelease:
    - manifests/operators/cf-admin-user
  20.local:
    - rename-deployment
    - pin-stemcell
    - set-versions
    - scale-disks
    - inject-variables # must be after 'use-cf-admin-user-link'
    - customize-services
    - fix-errands-vms-names # must be last


deployment_vars:
  deployment_name: easyfoundry-data-services


  # User-facing settings

  broker-route-uri: data-services.easyfoundry.prototyp.it


  # Versions

  cf_containers_broker_version: "1.0.3"
  cf_containers_broker_sha1: 11001a58965ce4243bd18f0e4301cdbbe949a2d9

  docker_version: "31.0.1"
  docker_sha1: d7fba11988621d8a8b57c2d298067e7d85e26148

  # NOTICE: Docker release v31.1.0 & v32.0.0 are no more compatible with
  #         stemcells versions above 3586.24
  #
  # # /var/vcap/packages/docker/bin/docker \
  #       -H :4243 --tls --tlscacert /var/vcap/jobs/docker/config/docker.cacert \
  #       --tlscert /var/vcap/jobs/docker/config/docker.cert --tlskey /var/vcap/jobs/docker/config/docker.key \
  #       run frodenas/mysql:5.6
  # /var/vcap/packages/docker/bin/docker: Error response from daemon: cgroups: cannot found cgroup mount destination: unknown.
  # ERRO[0001] error waiting for container: context canceled
  #
  # docker_version: "31.1.0"
  # docker_sha1: 5bd41b3ddb7005e90af09a93a7d3ea1649216260
  # docker_version: "32.0.0"
  # docker_sha1: 75a3e4f85f8d1a59b58c6b34cf568f72397b5680

  broker_registrar_version: "3.4.0"
  broker_registrar_sha1: d44d9af8fd06ecf6d50004c9bfd5516a6e482201

  # bpm_version:      # imported below
  # bpm_sha1:         # imported below

  # routing_version:  # imported below
  # routing_sha1:     # imported below

  # stemcell_os:      # imported below
  # stemcell_version: # imported below
  # stemcell_sha1:    # imported below


  # Reference declarations

  network_name: default


  # Plumbery

  broker-route-name: data-services-broker


imported_vars:
  - subsys: cf
    imports:

      - name: bpm_version
        from: depl-vars
        path: /bpm_version
      - name: bpm_sha1
        from: depl-vars
        path: /bpm_sha1

      - name: routing_version
        from: depl-vars
        path: /routing_version
      - name: routing_sha1
        from: depl-vars
        path: /routing_sha1

      - name: stemcell_os
        from: depl-vars
        path: /stemcell_os
      - name: stemcell_version
        from: depl-vars
        path: /stemcell_version
      - name: stemcell_sha1
        from: depl-vars
        path: /stemcell_sha1

      - name: cf_deployment_name
        from: depl-vars
        path: /deployment_name

      - name: cf_skip_ssl_validation
        from: depl-manifest
        path: /instance_groups/name=smoke-tests/jobs/name=smoke_tests/properties/smoke_tests/skip_ssl_validation
